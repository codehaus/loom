<?xml version="1.0" encoding="iso-8859-1"?>
<document>
    <properties>
        <title>Specification of assembly.xml </title>
    </properties>
    <body>
        <section name="The Assembly File">
            <p>
                The
                <code>assembly.xml</code> file defines how to assemble the
                application.  It defines the blocks that make up the application,
                and how to connect them together.  It also defines the
                application listeners to include in the application.
            </p>

            <p>
                In previous versions of Loom, configuration data was also
                stored in the assembly file.  This is no longer the case;
                Configuration is now stored in a separate
                <a href="config-xml-specification.html">Configuration File</a>.
            </p>

            <p>
                The root element of the assembly file must be an
                <code>&lt;assembly></code> element.  The root element
                must contain a child element for each block and application
                listener which is part of the application.  These elements
                are described below.
            </p>
        </section>

        <section name="The block Element">
            <p>
                The
                <code>&lt;block></code> element defines a block, and
                how to provide services to the block.  The
                <code>&lt;block></code> element takes the following
                attributes:
            </p>

            <table>
                <tr>
                    <th>Attribute</th>
                    <th>Description</th>
                </tr>
                <tr>
                    <td>class</td>
                    <td>
                        The fully-qualified name of the components's
                        implementing class. This class must be public, with
                        a public no-args constructor. The components must
                        have associated metadata.
                    </td>
                </tr>
                <tr>
                    <td>name</td>
                    <td>
                        A unique name for the block.  This name is used to
                        refer to the block in other parts of the assembly file,
                        and in the configuration file.  The block name may
                        only contain letters, digits, '-' and '.'.
                    </td>
                </tr>
            </table>

            <subsection name="The provide Element">
                <p>
                    The
                    <code>&lt;provide&gt;</code> element defines how to
                    provide a particular service to the block. It connects
                    the block to another block that provides the required service.
                    There must be at least one
                    <code>&lt;provide&gt;</code>
                    element for each dependency listed in the block's
                    metadata descriptor. For array and mapped services,
                    there may be more than one
                    <code>&lt;provide&gt;</code>
                    element for each dependency. The
                    <code>&lt;provide&gt;</code> element takes the following
                    attributes:
                </p>

                <table>
                    <tr>
                        <th>Attribute</th>
                        <th>Description</th>
                    </tr>
                    <tr>
                        <td>alias</td>
                        <td>
                            The key to use for the service, for mapped services.
                            Defaults to the value of the
                            <code>name</code>
                            attribute.
                        </td>
                    </tr>
                    <tr>
                        <td>name</td>
                        <td>
                            The name of the block to use to provide the service
                            to the target block.  This must refer to another
                            block in the same application.
                        </td>
                    </tr>
                    <tr>
                        <td>role</td>
                        <td>
                            The role of the service.  This must refer to
                            one of the dependencies listed in the block's
                            BlockInfo file.  The service name and version
                            specified by the dependency must match one of the
                            services listed in the provider block's
                            BlockInfo file.
                        </td>
                    </tr>
                </table>
            </subsection>

            <subsection name="The proxy Element">
                <p>
                    The
                    <code>&lt;proxy></code> element controls whether
                    Loom will wrap the block with a proxy object before
                    supplying it to other blocks.  The
                    <code>&lt;proxy></code>
                    element takes the following attributes:
                </p>
                <table>
                    <tr>
                        <th>Attribute</th>
                        <th>Description</th>
                    </tr>
                    <tr>
                        <td>disable</td>
                        <td>Disables the use of a proxy object.  Default is false.</td>
                    </tr>
                </table>
            </subsection>
        </section>

        <section name="The listener Element">
            <p>
                The
                <code>&lt;listener></code> element defines an application
                listener.  The
                <code>&lt;listener></code>  element takes the
                following attributes:
            </p>
            <table>
                <tr>
                    <th>Attribute</th>
                    <th>Description</th>
                </tr>
                <tr>
                    <td>class</td>
                    <td>
                        The fully qualified name of the listener class.
                        This class must be public and provide a public
                        no-args constructor.  It must implement the
                        <code>org.apache.avalon.phoenix.ApplicationListener</code>
                        interface.
                    </td>
                </tr>
                <tr>
                    <td>name</td>
                    <td>
                        A unique name for the listener, which is used to
                        refer to the listener in the configuration file.
                        The name may only contain letters, digits, '-' and '.'.
                    </td>
                </tr>
            </table>
        </section>

        <section name="The block-listener Element (Deprecated)">
            <p>
                The
                <code>&lt;block-listener></code> element defines
                a block listener.  Note that the use of block listeners
                is deprecated.  The
                <code>&lt;block-listener></code> element
                takes the same attributes as the
                <code>&lt;listener></code>
                element.
            </p>
        </section>

        <section name="Sample Assembly File">

            <p>
                Below is an example assembly file.  It defines 2 blocks, called
                <code>myAuthorizer</code> and
                <code>myBlock</code>, and a
                listener.  Block
                <code>myBlock</code> uses the
                <code>Authorizer</code> service provided by block
                <code>myAuthorizer</code>.
            </p>

            <source>

                &lt;?xml version="1.0"?>

                &lt;assembly>

                &lt;block name="myAuthorizer"
		class="com.biz.cornerstone.blocks.MyAuthorizer">
                &lt;/block>

                &lt;block name="myBlock"
		class="com.biz.cornerstone.blocks.MyBlock">
                &lt;provide name="myAuthorizer"
     		role="com.biz.cornerstone.services.Authorizer"/>
                &lt;/block>

                &lt;listener name="myListener"
		class="com.biz.cornerstone.listeners.MyListener">
                &lt;/listener>

                &lt;/assembly>
            </source>
        </section>
    </body>
</document>
