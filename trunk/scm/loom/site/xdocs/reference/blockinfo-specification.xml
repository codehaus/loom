<?xml version="1.0" encoding="iso-8859-1"?>
<document>
    <properties>
    	<title>BlockInfo Specification</title>
    	<author email="peter at apache.org">Peter Donald</author>
    </properties>

    <body>
        <section name="The BlockInfo File">
            <p>
                The BlockInfo file defines meta-information about a block, such
                as which services the block depends upon, and which services it
                can offer to other blocks.
            </p>

            <p>
                The BlockInfo file is an XML file.  It must be located in the same jar
                file as the block's implementing class.  It must have the same name
                as the block's class, with the extention <code>.xinfo</code>.  Thus,
                if you were looking up the BlockInfo for a block of class
                <code>com.biz.cornerstone.blocks.MyBlock</code>, you would look up the
                resource <code>com/biz/cornerstone/blocks/MyBlock.xinfo</code> in the
                jar file containing the block.
            </p>

            <p>
                Below is an example BlockInfo file:
            </p>
            <source>

&lt;?xml version="1.0"?>

&lt;blockinfo>

    &lt;block>
        &lt;version>1.2.3&lt;/version>
    &lt;/block>

    &lt;services>
        &lt;service name="com.biz.cornerstone.services.MyService"
                 version="2.1.3" />
    &lt;/services>

    &lt;dependencies>
        &lt;dependency>
            &lt;role>com.biz.cornerstone.services.Authorizer&lt;/role>
            &lt;service name="com.biz.cornerstone.service.Authorizer"
                     version="1.2"/>
        &lt;/dependency>
        &lt;dependency>
            &lt;!-- note that role is not specified and defaults
                 to name of service. The service version is not
                 specified and it defaults to "1.0" -->
            &lt;service name="com.biz.cornerstone.service.RoleMapper"/>
        &lt;/dependency>
    &lt;/dependencies>

&lt;/blockinfo>
            </source>

            <p>
                You will notice that the information in the BlockInfo file is separated
                into three main sections:
            </p>
            <ul>
                <li>The <code>&lt;block></code> element, which defines the name and version of the block.</li>
                <li>The <code>&lt;services></code> element, which defines the services the block provides.</li>
                <li>The <code>&lt;dependencies></code> element, which defines the services the block uses.</li>
            </ul>
        </section>

        <section name="The block Element">
            <p>
                The <code>&lt;block></code> element specifies the name and version
                of the block.  The <code>&lt;block></code> element includes
                the following nested elements:
            </p>
            <table>
                <tr>
          			<th>Element</th>
          			<th>Description</th>
		        </tr>
                <tr>
                    <td>
            <code>&lt;name></code>
        		    </td>
                    <td>A descriptive name for the block.  Optional.</td>
                </tr>
                <tr>
                    <td>
            <code>&lt;version></code>
          </td>
                    <td>
                        The version of the block.  Must be of the format
                        major.minor.micro, where minor and micro are optional.
                    </td>
                </tr>
                <tr>
                    <td>
            <code>&lt;schema-type></code>
          </td>
                    <td>
                        The type of configuration schema provided with the block.
                        Possible values depend on the Configuration Validator
                        that Loom is using.  This value is ignored by the
                        default Configuration Validator.  Optional.
                    </td>
                </tr>
            </table>
        </section>

        <section name="The services Element">
            <p>
                The <code>&lt;services></code> element defines the services
                that the block can offer to other blocks.  This element is optional;
                A block can choose to not offer any services to other blocks.
            </p>
            <p>
                The <code>&lt;services></code> element should contain a
                nested <code>&lt;service></code> element for each service
                that the block provides.  The <code>&lt;service></code>
                element takes the following attributes:
            </p>
            <table>
                <tr>
          <th>Name</th>
          <th>Description</th>
        </tr>
                <tr>
                    <td>name</td>
                    <td>
                        The service name.  This is the fully qualified name of
                        the service interface.  The block must implement this
                        interface.  The service name is also used to identify
                        the service in the BlockInfo files of blocks that use
                        the service (see below).
                    </td>
                </tr>
                <tr>
                    <td>version</td>
                    <td>
                        The version of the service.  This must be of the form
                        major.minor.micro, where minor and micro are optional.
                        Default value is 1.0.
                    </td>
                </tr>
            </table>
        </section>

        <section name="The dependencies Element">
            <p>
                The <code>&lt;dependencies></code> element defines the services
                that the block requires to operate.  Loom provides these
                services to the block using the <code>ServiceManager</code>
                passed to the block's <code>Serviceable.service()</code> method.
            </p>
            <p>
                The <code>&lt;dependencies></code> element should contain
                a nested <code>&lt;dependency></code> element for each
                service that the block uses.  The <code>&lt;dependency></code>
                element takes the following nested elements:
            </p>

            <subsection name="The service Element">
                <p>
                    The <code>&lt;service></code> element
                    defines the expected service.  The service element takes the following
                    attributes:
                </p>
                <table>
                    <tr>
            <th>Name</th>
            <th>Description</th>
          </tr>
                    <tr>
                        <td>name</td>
                        <td>
                            The service name.  This must be the fully qualified
                            name of the service interface.  The object returned
                            by the <code>ServiceManager</code> is guaranteed to
                            be castable to this interface.  The service name is
                            also used to identify the service in the BlockInfo
                            file of blocks that provide the service (see above).
                        </td>
                    </tr>
                    <tr>
                        <td>version</td>
                        <td>
                            The expected version of the service.  This must be of
                            the form major.minor.micro, where minor and micro are
                            optional.  The default value is 1.0.
                        </td>
                    </tr>
                </table>
            </subsection>

            <subsection name="The role Element"/>
            <p>
                The <code>&lt;role></code> element specifies the role that
                the service plays.  This must match the role name that the block
                supplies when it locates the service using
                <code>ServiceManager.lookup( role )</code>.
                The role name is also used in the
                <a href="assembly-xml-specification.html">Assembly File</a>,
                to identify the dependency when connecting the block to the
                services it requires.  The <code>&lt;role></code> element
                is optional, and the role name defaults to the service name.
            </p>
        </section>

        <section name="The management-access-points Element">
            <p>
                The <code>&lt;management-access-points></code> element
                defines the management interfaces that the block provides.
                These interfaces are exported by Loom's management system
                to allow the block to be managed.
            </p>
            <p>
                The <code>&lt;management-access-points></code> element must
                contain a <code>&lt;service></code> element for each of the
                block's management interfaces.  The <code>&lt;service></code>
                element takes the following attributes:
            </p>
            <table>
                <tr>
          <th>Name</th>
          <th>Description</th>
        </tr>
                <tr>
                    <td>name</td>
                    <td>
                        The fully qualified name of the management interface.
                        The block must implement this interface.
                    </td>
                </tr>
                <tr>
                    <td>version</td>
                    <td>
                        The version of the management interface.  Default value
                        is 1.0
                    </td>
                </tr>
            </table>
        </section>
    </body>
</document>
